# 時間序列數據分析與週期性檢測

本專案提供完整的時間序列數據分析工具，專門用於 Lomb-Scargle 週期圖分析和自定義模型擬合。

## 🚀 功能特色

- **Lomb-Scargle 週期圖分析**：檢測時間序列中的週期性信號
- **自定義模型擬合**：使用正弦/餘弦組合模型進行精確擬合
- **批量處理**：自動處理多個 CSV 文件
- **視覺化輸出**：生成高品質的 SVG 圖表
- **統計分析**：提供 R² 值、殘差分析等統計指標
- **錯誤處理**：穩健的錯誤處理機制，避免奇異矩陣問題

## 📦 安裝需求

```bash
pip install -r requirements.txt
```

### 主要依賴庫
- `pandas` - 數據處理
- `numpy` - 數值計算
- `plotly` - 互動式圖表
- `astropy` - Lomb-Scargle 分析
- `lmfit` - 非線性模型擬合
- `kaleido` - 圖片導出（SVG 格式）

## 🔧 使用方法

### 批量分析模式（推薦）

```bash
python fit5.py
```

程序將自動：
1. 掃描工作目錄中的所有 `*_ic.csv` 文件
2. 對每個文件執行 Lomb-Scargle 分析
3. 嘗試多組參數邊界進行自定義模型擬合
4. 生成可視化圖表並保存到 `Plot/` 目錄
5. 將統計結果匯出到 `all_results.csv`

### 輸出文件

- **分析結果**：`all_results.csv` - 包含所有文件的統計分析結果
- **圖表文件**：`Plot/` 目錄下的 SVG 圖表
  - `{filename}_ls_periodogram.svg` - Lomb-Scargle 週期圖
  - `{filename}_phase_folded.svg` - 相位折疊圖
  - `{filename}_custom_fit.svg` - 自定義模型擬合
  - `{filename}_residuals.svg` - 殘差分析

## 📊 數據格式要求

輸入 CSV 文件必須包含：
- `Time` 欄位：時間數據
- `Ic` 欄位：觀測值數據

範例數據格式：
```csv
Time,Ic
0.001,1.234e-5
0.002,1.456e-5
...
```

## 🔬 分析模型

### Lomb-Scargle 模型
用於檢測非等距時間序列中的週期性信號，特別適合天文觀測數據。

### 自定義模型
擴展的正弦/餘弦模型：
```
y = A*sin(2πf(x-d)-p) + B*cos(2πf(x-d)-p) + r(x-d) + r₂(x-d)² + C
```

參數說明：
- `A`, `B`：正弦和餘弦振幅
- `f`：頻率
- `d`：時間偏移
- `p`：相位
- `r`：線性趨勢
- `r₂`：二次趨勢
- `C`：常數偏移

## ⚡ 最新改進

### v2.0 更新（2025年6月）
- ✅ 修復奇異矩陣錯誤處理
- ✅ 優化代碼品質（移除不必要的 f-string）
- ✅ 增強錯誤處理機制
- ✅ 改進批量處理算法
- ✅ 自動生成高品質 SVG 圖表

## 📈 性能優化

- 智能參數邊界調整
- 多組邊界迭代擬合
- 自動目標 R² 值檢測（預設 0.95）
- 穩健的數值計算處理

## 🛠️ 故障排除

### 常見問題

1. **奇異矩陣錯誤**：已內建錯誤處理，會自動跳過問題頻率
2. **擬合失敗**：程序會嘗試多組參數邊界
3. **圖片無法生成**：確保已安裝 `kaleido` 庫

### 調試模式
如需詳細輸出信息，檢查控制台輸出中的警告和錯誤信息。

## 📝 開發說明

### 項目結構
```
├── fit5.py              # 主程序
├── fit5_main.py         # 主函數模組
├── fit5_plot.py         # 繪圖函數
├── fit5_utils.py        # 工具函數
├── requirements.txt     # 依賴庫清單
├── Plot/               # 輸出圖表目錄
└── *.csv              # 數據文件
```

---

## 📞 技術支援

如需進一步協助或發現問題，請：
1. 檢查控制台輸出的錯誤信息
2. 確認數據格式符合要求
3. 聯絡專案維護者

**版本**：v2.0  
**更新日期**：2025年6月1日